"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["5854"],{60579:function(e,t,a){a.d(t,{Z:()=>g});var s=a(65083),l=a(23125),i=a(58786),r=a(62594),o=a(56946),n=a(54470),u=a(53198),c=a(71309),p=a(53573),d=a(66480);let m=(0,c.c)([(0,c.c)("@keyframes spin-rotate",`
 from {
 transform: rotate(0);
 }
 to {
 transform: rotate(360deg);
 }
 `),(0,c.cB)("spin-container",`
 position: relative;
 `,[(0,c.cB)("spin-body",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[(0,d.h)()])]),(0,c.cB)("spin-body",`
 display: inline-flex;
 align-items: center;
 justify-content: center;
 flex-direction: column;
 `),(0,c.cB)("spin",`
 display: inline-flex;
 height: var(--n-size);
 width: var(--n-size);
 font-size: var(--n-size);
 color: var(--n-color);
 `,[(0,c.cM)("rotate",`
 animation: spin-rotate 2s linear infinite;
 `)]),(0,c.cB)("spin-description",`
 display: inline-block;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 margin-top: 8px;
 `),(0,c.cB)("spin-content",`
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 pointer-events: all;
 `,[(0,c.cM)("spinning",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: none;
 opacity: var(--n-opacity-spinning);
 `)])]),b={small:20,medium:18,large:16},v=Object.assign(Object.assign({},o.Z.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),g=(0,i.aZ)({name:"Spin",props:v,slots:Object,setup(e){let{mergedClsPrefixRef:t,inlineThemeDisabled:a}=(0,n.ZP)(e),r=(0,o.Z)("Spin","-spin",m,p.Z,e,t),d=(0,i.Fl)(()=>{let{size:t}=e,{common:{cubicBezierEaseInOut:a},self:l}=r.value,{opacitySpinning:i,color:o,textColor:n}=l;return{"--n-bezier":a,"--n-opacity-spinning":i,"--n-size":"number"==typeof t?(0,s.BL)(t):l[(0,c.Tl)("size",t)],"--n-color":o,"--n-text-color":n}}),v=a?(0,u.F)("spin",(0,i.Fl)(()=>{let{size:t}=e;return"number"==typeof t?String(t):t[0]}),d,e):void 0,g=(0,l.Z)(e,["spinning","show"]),f=(0,i.iH)(!1);return(0,i.m0)(t=>{let a;if(g.value){let{delay:s}=e;if(s){a=window.setTimeout(()=>{f.value=!0},s),t(()=>{clearTimeout(a)});return}}f.value=g.value}),{mergedClsPrefix:t,active:f,mergedStrokeWidth:(0,i.Fl)(()=>{let{strokeWidth:t}=e;if(void 0!==t)return t;let{size:a}=e;return b["number"==typeof a?"medium":a]}),cssVars:a?void 0:d,themeClass:null==v?void 0:v.themeClass,onRender:null==v?void 0:v.onRender}},render(){var e,t;let{$slots:a,mergedClsPrefix:s,description:l}=this,o=a.icon&&this.rotate,n=(l||a.description)&&(0,i.h)("div",{class:`${s}-spin-description`},l||(null==(e=a.description)?void 0:e.call(a))),u=a.icon?(0,i.h)("div",{class:[`${s}-spin-body`,this.themeClass]},(0,i.h)("div",{class:[`${s}-spin`,o&&`${s}-spin--rotate`],style:a.default?"":this.cssVars},a.icon()),n):(0,i.h)("div",{class:[`${s}-spin-body`,this.themeClass]},(0,i.h)(r.Z,{clsPrefix:s,style:a.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:`${s}-spin`}),n);return null==(t=this.onRender)||t.call(this),a.default?(0,i.h)("div",{class:[`${s}-spin-container`,this.themeClass],style:this.cssVars},(0,i.h)("div",{class:[`${s}-spin-content`,this.active&&`${s}-spin-content--spinning`,this.contentClass],style:this.contentStyle},a),(0,i.h)(i.uT,{name:"fade-in-transition"},{default:()=>this.active?u:null})):u}})},83077:function(e,t,a){a.d(t,{Z:()=>v});var s=a(58786),l=a(70392),i=a(82994),r=a(68449),o=a(90838),n=a(14863),u=a(72632),c=a(95691),p=a(58964),d=a(65391),m=a(45334),b=a(62635);let v={__name:"index",props:{options:{type:Object,required:!0},height:{type:[String,Number],default:"100%"},theme:{type:String,default:"default"},notMerge:{type:Boolean,default:!1},lazyUpdate:{type:Boolean,default:!1}},setup(e,t){let{expose:a}=t;l.D([n.N,u.N,c.N,p.N,d.N,m.N,r.N,o.N,b.N]);let v=(0,s.iH)(null),g=(0,s.Fl)(()=>"number"==typeof e.height?`${e.height}px`:e.height),f=null,_=null,S=()=>{v.value&&(f=i.S1(v.value,e.theme,{renderer:"canvas",useDirtyRect:!0}),y(),(_=new ResizeObserver(()=>{requestAnimationFrame(()=>{null==f||f.resize()})})).observe(v.value))},y=()=>{f&&e.options&&f.setOption(e.options,{notMerge:e.notMerge,lazyUpdate:e.lazyUpdate})};return(0,s.bv)(()=>{S()}),(0,s.SK)(()=>{null==_||_.disconnect(),f&&(f.dispose(),f=null)}),(0,s.YP)(()=>e.options,()=>{y()},{deep:!0}),(0,s.YP)(()=>e.theme,()=>{f&&(f.dispose(),S())}),a({getChartInstance:()=>f,resize:()=>null==f?void 0:f.resize()}),(e,t)=>((0,s.wg)(),(0,s.iD)("div",{ref_key:"chartRef",ref:v,style:(0,s.j5)({width:"100%",height:(0,s.SU)(g)})},null,4))}}},4340:function(e,t,a){a.d(t,{Z:()=>n});var s=a(15496),l=a(23685),i=a(58786);let r={class:"flex gap-10px"},o={class:"flex-center w-40px"},n=(0,i.aZ)({__name:"index",props:{data:{type:Array,default:()=>[]},rowKey:{type:Function,required:!0},options:{type:Array,default:()=>[]},checkedRowKeys:{type:Array,default:()=>[]}},emits:["updateCheckedRowKeys","select"],setup(e,t){let{emit:a}=t,n=(0,i.Fl)({get:()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length===e.data.length,set(t){a("updateCheckedRowKeys",t?e.data.map(t=>e.rowKey(t)):[])}}),u=(0,i.Fl)(()=>0===e.data.length),c=(0,i.Fl)(()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length<e.data.length),p=(0,i.Fl)(()=>0===e.checkedRowKeys.length),d=t=>{a("select",t,e.checkedRowKeys)};return(t,a)=>{let m=l.Z,b=s.ZP;return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",o,[(0,i.Wm)(m,{checked:(0,i.SU)(n),"onUpdate:checked":a[0]||(a[0]=e=>(0,i.dq)(n)?n.value=e:null),disabled:(0,i.SU)(u),indeterminate:(0,i.SU)(c)},null,8,["checked","disabled","indeterminate"])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.options,e=>((0,i.wg)(),(0,i.j4)(b,{key:e.value,disabled:(0,i.SU)(p)||e.disabled,onClick:t=>d(e.value)},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)(e.label),1)]),_:2},1032,["disabled","onClick"]))),128))])}}})},41161:function(e,t,a){a.r(t),a.d(t,{default:()=>eS});var s=a(39244),l=a(25170),i=a(60424),r=a(66760),o=a(86559),n=a(4340),u=a(8490),c=a(58786),p=a(94821),d=a(53903),m=a(93953),b=a(15496),v=a(68271),g=a(51169),f=a(80947),_=a(34541);let{t:S}=a(76882).ag.global,y=e=>_.e.get("/contact/list_ndp",{params:e}),h=e=>_.e.get("/contact/trend",{params:e}),w=e=>_.e.post("/contact/group/import",e,{fetchOptions:{loading:S("contacts.subscribers.loading.importSubscribers"),successMessage:!0}}),U=e=>_.e.post("/contact/edit_ndp",e,{fetchOptions:{loading:S("contacts.subscribers.loading.updateSubscriberGroup"),successMessage:!0}}),x=e=>_.e.post("/contact/delete_ndp",e,{fetchOptions:{loading:S("contacts.subscribers.loading.deleteSubscriber"),successMessage:!0}}),W=e=>_.e.post("/contact/batch_tags_opt",e,{fetchOptions:{loading:S("contacts.subscribers.loading.batchSetTag"),successMessage:!0}});var k=a(84075),Z=a(52495);let z=(0,c.aZ)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,Z.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.iH)([{label:t("common.all.text"),value:0}]);return(async()=>{let e=await (0,k.WH)();(0,v.Kn)(e)&&(s.value=e.list.map(e=>({label:e.name,value:e.id})),s.value.unshift({label:t("common.all.text"),value:0}))})(),(e,t)=>{let l=u.Z;return(0,c.wg)(),(0,c.j4)(l,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,c.SU)(s)},null,8,["value","options"])}}});var T=a(43458),C=a(65965);let O=(0,c.aZ)({__name:"TagSelect",props:(0,c.Vf)({groupId:{type:Number,default:0}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){let{t}=(0,Z.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.iH)([]),l=(0,c.Fl)(()=>s.value.filter(t=>0===e.groupId||e.groupId===t.group_id).map(e=>({label:e.name,value:e.id})));(async()=>{let e=await (0,T.CZ)({});(0,v.Kn)(e)&&(s.value=e.list)})();let i=(0,C.tv)(),r=()=>{i.push({path:"/contacts/tags",state:{group_id:e.groupId}})};return(e,s)=>{let i=b.ZP,o=u.Z;return(0,c.wg)(),(0,c.j4)(o,{value:a.value,"onUpdate:value":s[0]||(s[0]=e=>a.value=e),options:(0,c.SU)(l),multiple:!0,"max-tag-count":"responsive"},{action:(0,c.w5)(()=>[(0,c.Wm)(i,{block:"",onClick:r},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.tagSelect.manageTags")),1)]),_:1})]),_:1},8,["value","options"])}}}),$={class:"w-80px"},R={class:"w-120px"},F=(0,c.aZ)({__name:"ActiveSelect",props:{value:{default:-1},valueModifiers:{},time:{},timeModifiers:{}},emits:["update:value","update:time"],setup(e){let{t}=(0,Z.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.Fl)(()=>[{label:t("contacts.subscribers.activeSelect.options.all"),value:-1},{label:t("contacts.subscribers.activeSelect.options.yes"),value:1},{label:t("contacts.subscribers.activeSelect.options.no"),value:0}]),l=(0,c.tT)(e,"time"),i=(0,c.Fl)(()=>[{label:t("contacts.subscribers.activeSelect.timeOptions.past7Days"),value:7},{label:t("contacts.subscribers.activeSelect.timeOptions.pastMonth"),value:30},{label:t("contacts.subscribers.activeSelect.timeOptions.past90Days"),value:90},{label:t("contacts.subscribers.activeSelect.timeOptions.pastHalfYear"),value:180},{label:t("contacts.subscribers.activeSelect.timeOptions.pastYear"),value:365}]),r=e=>{-1===e?l.value=0:l.value=365};return(e,t)=>{let o=u.Z;return(0,c.wg)(),(0,c.iD)(c.HY,null,[(0,c._)("div",$,[(0,c.Wm)(o,{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),r],options:(0,c.SU)(s)},null,8,["value","options"])]),(0,c.wy)((0,c._)("div",R,[(0,c.Wm)(o,{value:l.value,"onUpdate:value":t[1]||(t[1]=e=>l.value=e),options:(0,c.SU)(i)},null,8,["value","options"])],512),[[c.F8,-1!==a.value]])],64)}}});var j=a(60579),P=a(83077);let H={class:"text-center fw-bold text-16px text-default"},D={class:"w-96% h-160px mx-auto"},N=(0,c.aZ)({__name:"SubscriberTrends",props:{params:{type:Object,default:()=>({page:1,page_size:10,group_id:0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:[]})}},setup(e,t){let{expose:a}=t,s=(0,c.iH)(!1),l=(0,c.iH)([]),{t:i}=(0,Z.QT)(),r=(0,c.Fl)(()=>({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:{data:l.value.map(e=>e.date),axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12}},yAxis:{type:"value",minInterval:1,axisLabel:{color:"#6b7280",fontSize:12}},series:[{name:i("contacts.subscribers.trends.subscriber"),type:"line",data:l.value.map(e=>e.count),itemStyle:{color:"#20a53a"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(32, 164, 58, 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}]})),o=async()=>{try{s.value=!0;let t=await h({group_id:e.params.group_id,active:e.params.active,last_active_status:e.params.last_active_status,time_interval:e.params.time_interval,tags:e.params.tags.join(",")});(0,v.Kn)(t)&&("monthly"===t.time_granularity?l.value=(0,v.kJ)(t.monthly_data)?t.monthly_data:[]:"daily"===t.time_granularity&&(l.value=(0,v.kJ)(t.daily_data)?t.daily_data:[]))}finally{s.value=!1}};return(0,c.bv)(()=>{o()}),a({getData:o}),(e,t)=>{let a=P.Z,l=j.Z;return(0,c.wg)(),(0,c.j4)(l,{class:"mb-16px",show:(0,c.SU)(s)},{default:(0,c.w5)(()=>[(0,c._)("div",H,(0,c.zw)((0,c.SU)(i)("contacts.subscribers.trends.title")),1),(0,c._)("div",D,[(0,c.Wm)(a,{options:(0,c.SU)(r)},null,8,["options"])])]),_:1},8,["show"])}}});var K=a(46244),M=a(73084),q=a(3179),A=a(16715),B=a(77227),I=a(81833),G=a(37864),L=a(6455),Y=a(46471),E=a(98003);let Q=(0,c.aZ)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,c.tT)(e,"value"),a=(0,c.iH)([]),s=(0,c.iH)(!1);return(async()=>{try{s.value=!0;let e=await (0,k.WH)();(0,v.Kn)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{s.value=!1}})(),(e,l)=>{let i=u.Z;return(0,c.wg)(),(0,c.j4)(i,{value:t.value,"onUpdate:value":l[0]||(l[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,c.SU)(s),options:(0,c.SU)(a)},null,8,["value","loading","options"])}}}),X={class:"pt-12px"},J={class:"flex-1"},V={class:"mb-8px text-desc"},ee={class:"w-260px"},et={class:"flex-1"},ea={class:"mt-8px"},es={class:"mt-8px text-12px text-desc"},el={class:"mt-8px text-12px text-desc"},ei=`email,attributes
example1@example.com,"{""age"": ""13"", ""Gender"": ""XXX""}"
example2@example.com,"{""age"": ""45"", ""city"": ""XXX""}"
`,er=(0,c.aZ)({__name:"SubscriberImport",setup(e){let{t}=(0,Z.QT)(),a=(0,c.AE)("formRef"),s=(0,c.iH)("paste"),l=(0,c.qj)({group_ids:[],import_type:1,contacts:"",file_data:"",file_type:"",overwrite:0,default_active:1,status:1}),i={group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{validator:()=>!(2===l.import_type&&(0,Y.Z)(l.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},r=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.overwriteOptions.no"),value:0},{label:t("contacts.subscribers.import.overwriteOptions.yes"),value:1}]),o=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.subscriptionOptions.subscribe"),value:1},{label:t("contacts.subscribers.import.subscriptionOptions.unsubscribe"),value:0}]),n=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),p=e=>{let t=new FileReader;t.onload=t=>{var a;l.file_type=e.name.substring(e.name.lastIndexOf(".")+1),l.file_data=null==(a=t.target)?void 0:a.result},e.file&&t.readAsText(e.file)},d=async()=>{await (0,E.Sv)({file_path:"./template/example_recipients.csv"})},m=async()=>{var e;if(await (null==(e=a.value)?void 0:e.validate()),"upload"===s.value&&(0,Y.Z)(l.file_data))return v.v0.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[f,_]=(0,g.d)({onChangeState:e=>{if(e){let e=_.getState();(null==e?void 0:e.group_id)?l.group_ids=[e.group_id]:l.group_ids=[]}else l.import_type=1,l.contacts="",l.file_data="",l.file_type="",l.group_ids=[],l.overwrite=0,l.default_active=1,l.status=1},onConfirm:async()=>{await m(),await w((0,c.IU)(l));let e=_.getState();null==e||e.refresh()}});return(e,t)=>{let s=u.Z,m=L.ZP,v=G.ZP,g=I.Z,_=B.Z,S=A.Z,y=q.Z,h=b.ZP,w=M.Z,U=K.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(f),{title:e.$t("contacts.subscribers.import.title"),width:"640"},{default:(0,c.w5)(()=>[(0,c._)("div",X,[(0,c.Wm)(U,{ref_key:"formRef",ref:a,model:(0,c.SU)(l),rules:i},{default:(0,c.w5)(()=>[(0,c.Wm)(m,{label:e.$t("contacts.subscribers.import.overwriteLabel")},{default:(0,c.w5)(()=>[(0,c._)("div",J,[(0,c._)("div",V,(0,c.zw)(e.$t("contacts.subscribers.import.overwriteDescription")),1),(0,c._)("div",ee,[(0,c.Wm)(s,{value:(0,c.SU)(l).overwrite,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(l).overwrite=e),options:(0,c.SU)(r)},null,8,["value","options"])])])]),_:1},8,["label"]),(0,c.Wm)(g,{cols:2,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(v,{span:1,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.w5)(()=>[(0,c.Wm)(s,{value:(0,c.SU)(l).default_active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(l).default_active=e),options:(0,c.SU)(o)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.Wm)(v,{span:1,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.w5)(()=>[(0,c.Wm)(s,{value:(0,c.SU)(l).status,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(l).status=e),options:(0,c.SU)(n)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(m,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,c.w5)(()=>[(0,c.Wm)(Q,{value:(0,c.SU)(l).group_ids,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(m,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,c.w5)(()=>[(0,c._)("div",et,[(0,c.Wm)(S,{value:(0,c.SU)(l).import_type,"onUpdate:value":t[4]||(t[4]=e=>(0,c.SU)(l).import_type=e)},{default:(0,c.w5)(()=>[(0,c.Wm)(_,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1}),(0,c.Wm)(_,{value:2},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",ea,[1===(0,c.SU)(l).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:0},[(0,c.Wm)(y,{"is-upload":!1,accept:["csv"],onChange:p}),(0,c._)("div",es,[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,c.Wm)(h,{text:"",type:"primary",onClick:d},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,c.kq)("",!0),2===(0,c.SU)(l).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[(0,c.Wm)(w,{value:(0,c.SU)(l).contacts,"onUpdate:value":t[5]||(t[5]=e=>(0,c.SU)(l).contacts=e),type:"textarea",rows:8},null,8,["value"]),(0,c._)("div",el,[(0,c._)("p",null,(0,c.zw)(e.$t("contacts.subscribers.import.pastePlaceholder.0")),1)])],64)):(0,c.kq)("",!0)])])]),_:1},8,["label"]),(0,c.Wm)(m,{label:e.$t("contacts.subscribers.import.exampleCsvLabel")},{default:(0,c.w5)(()=>[(0,c._)("pre",{class:"csv-example"},(0,c.zw)(ei))]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var eo=a(41748);let en=(0,eo.default)(er,[["__scopeId","data-v-517af80a"]]),eu={class:"pt-12px"},ec=(0,c.aZ)({__name:"SubscriberEdit",setup(e){let{t}=(0,Z.QT)(),a=(0,c.AE)("formRef"),s=(0,c.qj)({id:0,email:"",active:1,status:1,attribs:"",group_ids:[]}),l={group_ids:{trigger:"change",validator:()=>0!==s.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},i=(0,c.Fl)(()=>[{label:t("contacts.subscribers.edit.statusOptions.subscribe"),value:1},{label:t("contacts.subscribers.edit.statusOptions.unsubscribe"),value:0}]),r=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),[o,n]=(0,g.d)({onChangeState:e=>{if(e){let{row:e}=n.getState();e&&(s.id=e.id,s.email=e.email,s.active=e.active,s.status=e.status,s.group_ids=[e.group_id],s.attribs=e.attribs?JSON.stringify(e.attribs,null,2):"")}else s.id=0,s.email="",s.active=1,s.status=1,s.group_ids=[],s.attribs=""},onConfirm:async()=>{var e;await (null==(e=a.value)?void 0:e.validate());let t={};try{t=s.attribs?JSON.parse(s.attribs):{}}catch(e){return v.v0.error(`${e}`,{close:!0}),!1}await U({id:s.id,active:s.active,status:s.status,attribs:JSON.stringify(t)}),n.getState().refresh()}});return(e,t)=>{let n=M.Z,p=G.ZP,d=u.Z,m=I.Z,b=L.ZP,v=K.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(o),{title:e.$t("contacts.subscribers.edit.title"),width:"600"},{default:(0,c.w5)(()=>[(0,c._)("div",eu,[(0,c.Wm)(v,{ref_key:"formRef",ref:a,model:(0,c.SU)(s),rules:l},{default:(0,c.w5)(()=>[(0,c.Wm)(m,{cols:12,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{span:8,label:e.$t("contacts.subscribers.edit.email")},{default:(0,c.w5)(()=>[(0,c.Wm)(n,{value:(0,c.SU)(s).email,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(s).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(p,{span:4,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{value:(0,c.SU)(s).active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(s).active=e),options:(0,c.SU)(i)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(m,{cols:12,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{span:8,label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,c.w5)(()=>[(0,c.Wm)(Q,{value:(0,c.SU)(s).group_ids,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(s).group_ids=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(p,{span:4,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{value:(0,c.SU)(s).status,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(s).status=e),options:(0,c.SU)(r)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(b,{label:e.$t("contacts.subscribers.edit.attributes")},{default:(0,c.w5)(()=>[(0,c.Wm)(n,{value:(0,c.SU)(s).attribs,"onUpdate:value":t[4]||(t[4]=e=>(0,c.SU)(s).attribs=e),type:"textarea",rows:6},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var ep=a(12112);let ed={class:"flex-1 mr-12px"},em=(0,c.aZ)({__name:"BatchSetTag",setup(e){let{t}=(0,Z.QT)(),a=(0,c.qj)({tag_ids:[],action:1}),s=(0,c.iH)([]),l=(0,c.Fl)(()=>[{label:t("contacts.subscribers.batchSetTag.actions.add"),value:1},{label:t("contacts.subscribers.batchSetTag.actions.remove"),value:2}]),i=(0,c.iH)(!1),r=async()=>{try{i.value=!0;let e=await (0,T.CZ)({});if((0,v.Kn)(e)){let{groupId:t}=f.getState();s.value=e.list.filter(e=>e.group_id===t).map(e=>({label:e.name,value:e.id}))}}finally{i.value=!1}},[o,n]=(0,g.d)({component:ep.Z,state:{refresh:r}}),p=()=>{let{groupId:e}=f.getState();n.setState({row:null,isEdit:!1,groupId:e}),n.open()},d=()=>{a.tag_ids=[],a.action=1,s.value=[]},[m,f]=(0,g.d)({onChangeState:e=>{e?r():d()},onConfirm:async()=>{let{ids:e,refresh:t}=f.getState();await W({ids:e,tag_ids:a.tag_ids,action:a.action}),t()}});return(e,r)=>{let n=u.Z,d=b.ZP,v=L.ZP,g=K.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(m),{title:(0,c.SU)(t)("contacts.subscribers.batchSetTag.title"),width:500},{default:(0,c.w5)(()=>[(0,c.Wm)(g,{class:"pt-8px"},{default:(0,c.w5)(()=>[(0,c.Wm)(v,{label:(0,c.SU)(t)("contacts.subscribers.batchSetTag.labels.tag")},{default:(0,c.w5)(()=>[(0,c._)("div",ed,[(0,c.Wm)(n,{value:(0,c.SU)(a).tag_ids,"onUpdate:value":r[0]||(r[0]=e=>(0,c.SU)(a).tag_ids=e),options:(0,c.SU)(s),multiple:!0,loading:(0,c.SU)(i),"max-tag-count":"responsive"},null,8,["value","options","loading"])]),(0,c.Wm)(d,{type:"primary",text:"",onClick:p},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.create")),1)]),_:1})]),_:1},8,["label"]),(0,c.Wm)(v,{label:(0,c.SU)(t)("contacts.subscribers.batchSetTag.labels.action")},{default:(0,c.w5)(()=>[(0,c.Wm)(n,{value:(0,c.SU)(a).action,"onUpdate:value":r[1]||(r[1]=e=>(0,c.SU)(a).action=e),options:(0,c.SU)(l)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.Wm)((0,c.SU)(o))]),_:1})]),_:1},8,["title"])}}}),eb={class:"w-140px"},ev={class:"w-140px"},eg={class:"w-200px"};function ef(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,c.lA)(e)}let e_=(0,c.aZ)({__name:"index",setup(e){let{t}=(0,Z.QT)(),a=(0,p.tLD)(),_=(0,C.tv)(),S=(0,c.AE)("trendRef"),h=(0,c.Fl)(()=>[{label:t("common.all.text"),value:-1},{label:t("contacts.subscribers.status.subscribed"),value:1},{label:t("contacts.subscribers.status.unsubscribed"),value:0}]),{tableParams:w,tableProps:U,batchProps:W,pageProps:k,fetchTable:T,resetTable:$}=(0,f.N)({params:{page:1,page_size:10,group_id:a.value.state.group_id||0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:a.value.state.tag_id?[a.value.state.tag_id]:[]},useParams:e=>({...e,tags:e.tags.join(",")}),fetchFn:y}),R=(0,c.Fl)(()=>[{type:"selection",width:40},{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"status",title:t("contacts.subscribers.labels.status").replace("ï¼š",""),minWidth:100,render:e=>{let a;if(0===e.active){let e;return(0,c.Wm)(d.ZP,{size:"small",type:"error",bordered:!1},ef(e=t("contacts.subscribers.status.unsubscribed"))?e:{default:()=>[e]})}if(1===e.active&&0===e.status){let e;return(0,c.Wm)(d.ZP,{size:"small",type:"default",bordered:!1},ef(e=t("contacts.subscribers.status.unconfirmed"))?e:{default:()=>[e]})}return(0,c.Wm)(d.ZP,{size:"small",type:"success",bordered:!1},ef(a=t("contacts.subscribers.status.subscribed"))?a:{default:()=>[a]})}},{key:"last_active_at",title:t("contacts.subscribers.columns.lastActiveAt"),minWidth:100,render:e=>e.last_active_at?(0,p.INm)(new Date(1e3*e.last_active_at)).value:"--"},{key:"groups",title:t("contacts.subscribers.joinGroup"),minWidth:100,render:e=>e.group_name||""},{key:"tags",title:t("contacts.subscribers.tags"),minWidth:100,render:e=>{let t;return e.tags&&0!==e.tags.length?(0,c.Wm)(m.Z,{inline:!0},ef(t=e.tags.map(e=>(0,c.Wm)(d.ZP,{key:e.id,size:"small",bordered:!1},{default:()=>[e.name]})))?t:{default:()=>[t]}):"--"}},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,s;return(0,c.Wm)(m.Z,{inline:!0},{default:()=>[(0,c.Wm)(b.ZP,{type:"primary",text:!0,onClick:()=>{B(e)}},ef(a=t("common.actions.edit"))?a:{default:()=>[a]}),(0,c.Wm)(b.ZP,{type:"error",text:!0,onClick:()=>{I(e)}},ef(s=t("common.actions.delete"))?s:{default:()=>[s]})]})}}]),j=()=>{var e;$(),null==(e=S.value)||e.getData()},P=()=>{w.value.tags=[],j()},[H,D]=(0,g.d)({component:en,state:{refresh:T}}),K=()=>{D.setState({group_id:w.value.group_id}),D.open()},M=()=>{if(!w.value.group_id)return void v.v0.warning(t("contacts.subscribers.selectGroupHint"));_.push(`/contacts/settings/${w.value.group_id}`)},[q,A]=(0,g.d)({component:ec,state:{refresh:T}}),B=e=>{A.setState({row:e}),A.open()},I=e=>{(0,v.iG)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await x({ids:[e.id]}),T()}})},G=(0,c.Fl)(()=>[{label:t("common.actions.delete"),value:"delete"},{label:t("contacts.subscribers.actions.setTag"),value:"tag",disabled:0===w.value.group_id}]),L=(e,t)=>{switch(e){case"delete":Y(t);break;case"tag":X(t)}},Y=e=>{(0,v.iG)({title:t("contacts.subscribers.batchDelete.title"),content:t("contacts.subscribers.batchDelete.confirm"),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await x({ids:e}),T()}})},[E,Q]=(0,g.d)({component:em,state:{refresh:T}}),X=e=>{Q.setState({ids:e,groupId:w.value.group_id}),Q.open()};return(e,a)=>{let p=u.Z,d=n.Z,m=o.Z,v=r.Z,g=i.Z,f=l.Z,_=s.Z;return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(N,{ref_key:"trendRef",ref:S,params:(0,c.SU)(w)},null,8,["params"]),(0,c.Wm)(_,null,{toolsLeft:(0,c.w5)(()=>[(0,c._)("span",null,(0,c.zw)(e.$t("contacts.subscribers.select.prefix")),1),(0,c._)("div",eb,[(0,c.Wm)(z,{value:(0,c.SU)(w).group_id,"onUpdate:value":[a[0]||(a[0]=e=>(0,c.SU)(w).group_id=e),P]},null,8,["value"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.status")),1),(0,c._)("div",ev,[(0,c.Wm)(p,{value:(0,c.SU)(w).active,"onUpdate:value":[a[1]||(a[1]=e=>(0,c.SU)(w).active=e),a[2]||(a[2]=()=>j())],options:(0,c.SU)(h)},null,8,["value","options"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.tags")),1),(0,c._)("div",eg,[(0,c.Wm)(O,{value:(0,c.SU)(w).tags,"onUpdate:value":[a[3]||(a[3]=e=>(0,c.SU)(w).tags=e),a[4]||(a[4]=()=>j())],disabled:0===(0,c.SU)(w).group_id,"group-id":(0,c.SU)(w).group_id},null,8,["value","disabled","group-id"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.active")),1),(0,c.Wm)(F,{value:(0,c.SU)(w).last_active_status,"onUpdate:value":[a[5]||(a[5]=e=>(0,c.SU)(w).last_active_status=e),a[7]||(a[7]=()=>j())],time:(0,c.SU)(w).time_interval,"onUpdate:time":[a[6]||(a[6]=e=>(0,c.SU)(w).time_interval=e),a[8]||(a[8]=()=>j())]},null,8,["value","time"])]),pageLeft:(0,c.w5)(()=>[(0,c.Wm)(d,(0,c.dG)((0,c.SU)(W),{options:(0,c.SU)(G),onSelect:L}),null,16,["options"])]),toolsRight:(0,c.w5)(()=>[(0,c.Wm)(m,{value:(0,c.SU)(w).keyword,"onUpdate:value":a[9]||(a[9]=e=>(0,c.SU)(w).keyword=e),width:240,placeholder:(0,c.SU)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:(0,c.SU)($)},null,8,["value","placeholder","onSearch"]),(0,c.Wm)((0,c.SU)(b.ZP),{type:"primary",onClick:K},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.import")),1)]),_:1}),(0,c.SU)(w).group_id?((0,c.wg)(),(0,c.j4)((0,c.SU)(b.ZP),{key:0,onClick:M},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.settings")),1)]),_:1})):(0,c.kq)("",!0)]),table:(0,c.w5)(()=>[(0,c.Wm)(g,(0,c.dG)((0,c.SU)(U),{columns:(0,c.SU)(R)}),{empty:(0,c.w5)(()=>[(0,c.Wm)(v)]),_:1},16,["columns"])]),pageRight:(0,c.w5)(()=>[(0,c.Wm)(f,(0,c.dG)((0,c.SU)(k),{onRefresh:(0,c.SU)(T)}),null,16,["onRefresh"])]),modal:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(H)),(0,c.Wm)((0,c.SU)(q)),(0,c.Wm)((0,c.SU)(E))]),_:1})])}}}),eS=(0,eo.default)(e_,[["__scopeId","data-v-a539d184"]])}}]);